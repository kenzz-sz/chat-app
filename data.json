{"users":["ewe","agus","gus","fkz","ee"],"chats":{"global":[{"sender":"fuck","text":"um","timestamp":"2026-01-16T02:57:06.614Z"},{"sender":"fkz","text":"ell","timestamp":"2026-01-16T03:08:00.382Z"},{"sender":"ee","text":"ee","timestamp":"2026-01-16T03:08:03.353Z"},{"sender":"fkz","text":"<!DOCTYPE html> <html lang=\"id\"> <head>     <meta charset=\"UTF-8\">     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">     <title>GitHub Messenger</title>     <script src=\"https://cdn.tailwindcss.com\"></script>     <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\">     <style>         /* Custom Scrollbar */         ::-webkit-scrollbar { width: 5px; }         ::-webkit-scrollbar-track { background: transparent; }         ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }         .active-chat { background-color: #eff6ff; border-right: 4px solid #2563eb; }     </style> </head> <body class=\"bg-slate-100 h-screen overflow-hidden font-sans\">      <div id=\"login-screen\" class=\"fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4\">         <div class=\"bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center\">             <div class=\"w-16 h-16 bg-blue-600 rounded-full mx-auto flex items-center justify-center text-white text-2xl mb-4\">                 <i class=\"fas fa-user-astronaut\"></i>             </div>             <h2 class=\"text-2xl font-bold text-gray-800 mb-2\">Login Messenger</h2>             <p class=\"text-gray-500 text-sm mb-6\">Pastikan konfigurasi GitHub sudah benar di kodingan.</p>                          <input type=\"text\" id=\"username-input\" placeholder=\"Buat Username Unik...\" class=\"w-full p-3 bg-gray-100 rounded-xl mb-4 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none\">             <button onclick=\"loginUser()\" id=\"login-btn\" class=\"w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 transition\">                 Masuk / Daftar             </button>         </div>     </div>      <div id=\"app-screen\" class=\"hidden flex h-full max-w-7xl mx-auto shadow-2xl bg-white\">                  <div class=\"w-full md:w-1/3 border-r flex flex-col bg-white\">             <div class=\"p-4 bg-slate-50 border-b flex justify-between items-center\">                 <div class=\"flex items-center gap-2\">                     <div class=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold\" id=\"my-avatar\">A</div>                     <span class=\"font-bold text-gray-700 truncate\" id=\"display-name\">User</span>                 </div>                 <button onclick=\"location.reload()\" class=\"text-gray-400 hover:text-red-500\"><i class=\"fas fa-sign-out-alt\"></i></button>             </div>              <div class=\"p-3 border-b space-y-2\">                 <button onclick=\"showAddFriendModal()\" class=\"w-full py-2 px-3 bg-blue-50 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-100 text-left\">                     <i class=\"fas fa-user-plus mr-2\"></i> Chat Teman Baru                 </button>                 <button onclick=\"createNewGroup()\" class=\"w-full py-2 px-3 bg-green-50 text-green-600 rounded-lg text-sm font-semibold hover:bg-green-100 text-left\">                     <i class=\"fas fa-users mr-2\"></i> Buat Grup Baru                 </button>             </div>              <div id=\"chat-list\" class=\"flex-1 overflow-y-auto\">                 </div>         </div>          <div class=\"hidden md:flex flex-1 flex-col bg-slate-50 relative w-full\" id=\"chat-area\">                          <div class=\"p-4 bg-white border-b flex justify-between items-center shadow-sm\">                 <div class=\"flex items-center gap-3\">                     <button class=\"md:hidden text-gray-500\" onclick=\"backToMenu()\"><i class=\"fas fa-arrow-left\"></i></button>                     <div>                         <h3 class=\"font-bold text-gray-800\" id=\"current-room-name\">Pilih Chat</h3>                         <p class=\"text-xs text-green-500\" id=\"status-indicator\">Ready</p>                     </div>                 </div>                 <button onclick=\"refreshData()\" class=\"text-gray-400 hover:text-blue-500\"><i class=\"fas fa-sync-alt\"></i></button>             </div>              <div id=\"messages-container\" class=\"flex-1 p-4 overflow-y-auto space-y-4\">                 <div class=\"text-center text-gray-400 mt-10\">Pilih teman atau grup di samping untuk mulai chat.</div>             </div>              <div class=\"p-3 bg-white border-t\">                 <div class=\"flex gap-2 bg-gray-100 p-1 rounded-full border focus-within:ring-2 focus-within:ring-blue-500 focus-within:bg-white\">                     <input type=\"text\" id=\"msg-input\" placeholder=\"Tulis pesan...\" class=\"flex-1 bg-transparent px-4 py-2 outline-none\" disabled>                     <button onclick=\"sendMessage()\" id=\"send-btn\" class=\"w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center justify-center transition disabled:opacity-50\" disabled>                         <i class=\"fas fa-paper-plane\"></i>                     </button>                 </div>             </div>         </div>     </div>      <script>         // ==========================================         // ‚ö†Ô∏è KONFIGURASI WAJIB DIISI ‚ö†Ô∏è         // ==========================================         const GH_CONFIG = {             owner: \"USERNAME_GITHUB\",               repo: \"NAMA_REPO\",                      path: \"data.json\",                      token: \"TOKEN_GITHUB\"               };         // ==========================================          let currentUser = \"\";         let currentRoomId = \"\";          let globalData = { users: [], chats: { \"global\": [] } };         let lastSha = \"\";         let poller = null;          // --- LOGIN SYSTEM ---         async function loginUser() {             const input = document.getElementById('username-input');             const username = input.value.trim().replace(/[^a-zA-Z0-9]/g, ''); // Hanya huruf angka              if (!username) { alert(\"Username tidak boleh kosong/simbol aneh!\"); return; }             if (GH_CONFIG.owner === \"USERNAME_GITHUB\") { alert(\"EDIT DULU KONFIGURASINYA DI KODINGAN!\"); return; }              const btn = document.getElementById('login-btn');             btn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Loading...';             btn.disabled = true;              try {                 // 1. Ambil data database                 await fetchData(true);                  // 2. Cek apakah user baru                 if (!globalData.users.includes(username)) {                     // Register user baru                     globalData.users.push(username);                     await saveData(`Register user ${username}`);                 }                  // 3. Masuk App                 currentUser = username;                 document.getElementById('my-avatar').innerText = currentUser.charAt(0).toUpperCase();                 document.getElementById('display-name').innerText = currentUser;                  document.getElementById('login-screen').classList.add('hidden');                 document.getElementById('app-screen').classList.remove('hidden');                 document.getElementById('app-screen').classList.add('flex');                  renderChatList();                 poller = setInterval(fetchData, 3500); // Auto refresh tiap 3.5 detik              } catch (e) {                 alert(\"Gagal Login: \" + e.message);                 btn.disabled = false;                 btn.innerText = \"Masuk / Daftar\";             }         }          // --- CORE DATA FUNCTIONS ---         async function fetchData(isFirstLoad = false) {             const indicator = document.getElementById('status-indicator');             if(!isFirstLoad) indicator.innerText = \"Syncing...\";              try {                 const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}?t=${Date.now()}`;                 const res = await fetch(url, {                     headers: { 'Authorization': `token ${GH_CONFIG.token}` },                     cache: \"no-store\"                 });                  if (res.status === 404) throw new Error(\"File data.json tidak ditemukan! Buat dulu di GitHub dengan isi {}\");                 if (!res.ok) throw new Error(\"Koneksi bermasalah\");                  const data = await res.json();                                  if (data.sha === lastSha) {                     indicator.innerText = \"Online\";                     return; // Tidak ada perubahan                 }                  lastSha = data.sha;                 const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));                                  // Normalisasi struktur data jika masih kosong/format lama                 if (Array.isArray(content)) {                     globalData = { users: [], chats: { \"global\": content } }; // Migrasi dari versi lama                 } else {                     globalData = content;                     if (!globalData.users) globalData.users = [];                     if (!globalData.chats) globalData.chats = {};                 }                  indicator.innerText = \"Online\";                                  // Re-render UI                 renderChatList();                 if (currentRoomId) renderMessages(currentRoomId);              } catch (e) {                 console.error(e);                 indicator.innerText = \"Error!\";             }         }          async function saveData(commitMessage) {             const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}`;             const contentEncoded = btoa(unescape(encodeURIComponent(JSON.stringify(globalData))));              const res = await fetch(url, {                 method: 'PUT',                 headers: {                     'Authorization': `token ${GH_CONFIG.token}`,                     'Content-Type': 'application/json'                 },                 body: JSON.stringify({                     message: commitMessage,                     content: contentEncoded,                     sha: lastSha                 })             });              if (!res.ok) throw new Error(\"Gagal menyimpan data (Conflict). Coba lagi.\");             const data = await res.json();             lastSha = data.content.sha; // Update SHA baru         }          // --- LOGIC ROOM & CHAT ---         function getRoomId(userA, userB) {             // Urutkan nama abjad supaya ID nya konsisten siapa pun yang buka             return [userA, userB].sort().join('_');         }          function showAddFriendModal() {             const targetUser = prompt(\"Masukkan Username teman yang ingin di-chat:\");             if (!targetUser) return;             if (targetUser === currentUser) return alert(\"Gak bisa chat diri sendiri.\");                          // Cek apakah user terdaftar di database             if (!globalData.users.includes(targetUser)) {                 alert(\"User tersebut belum terdaftar (belum pernah login).\");                 return;             }              const roomId = getRoomId(currentUser, targetUser);             openChat(roomId, targetUser);         }          function createNewGroup() {             const groupName = prompt(\"Masukkan Nama Grup:\");             if (!groupName) return;             const roomId = \"GROUP_\" + groupName.replace(/\\s+/g, '_');                          if (!globalData.chats[roomId]) {                 globalData.chats[roomId] = []; // Init grup kosong                 saveData(`Create group ${groupName}`); // Simpan biar muncul di orang lain             }             openChat(roomId, groupName);         }          function openChat(roomId, displayTitle) {             currentRoomId = roomId;                          // UI Update             document.getElementById('current-room-name').innerText = displayTitle;             document.getElementById('msg-input').disabled = false;             document.getElementById('send-btn').disabled = false;             document.getElementById('chat-area').classList.remove('hidden');             document.getElementById('chat-area').classList.add('flex');                          // Mobile view toggle             if(window.innerWidth < 768) {                 document.querySelector('.w-full.md\\\\:w-1\\\\/3').classList.add('hidden');             }              // Pastikan array chat ada             if (!globalData.chats[roomId]) {                 globalData.chats[roomId] = [];             }              renderMessages(roomId);             renderChatList(); // Untuk highlight active chat         }          function backToMenu() {             document.getElementById('chat-area').classList.add('hidden');             document.querySelector('.w-full.md\\\\:w-1\\\\/3').classList.remove('hidden');             currentRoomId = \"\";         }          // --- RENDERING UI ---         function renderChatList() {             const list = document.getElementById('chat-list');             list.innerHTML = \"\";              // 1. Global Chat (Selalu ada)             renderValidChatItem(\"global\", \"Global Chat\", \"fas fa-globe\");              // 2. Loop semua key di chats untuk mencari chat yang relevan dengan user ini             Object.keys(globalData.chats).forEach(roomId => {                 if (roomId === \"global\") return;                  // Logika Group                 if (roomId.startsWith(\"GROUP_\")) {                     const groupName = roomId.replace(\"GROUP_\", \"\").replace(/_/g, \" \");                     renderValidChatItem(roomId, groupName, \"fas fa-users\");                 }                 // Logika Private Chat (Cek apakah nama kita ada di ID room)                 else if (roomId.includes(currentUser)) {                     // Extract nama lawan bicara                     const parts = roomId.split('_');                     const friendName = parts[0] === currentUser ? parts[1] : parts[0];                     renderValidChatItem(roomId, friendName, \"fas fa-user\");                 }             });              function renderValidChatItem(id, name, icon) {                 const div = document.createElement('div');                 const isActive = id === currentRoomId;                 div.className = `p-3 flex items-center gap-3 cursor-pointer hover:bg-gray-100 transition ${isActive ? 'active-chat' : ''}`;                 div.onclick = () => openChat(id, name);                                  div.innerHTML = `                     <div class=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600\">                         <i class=\"${icon}\"></i>                     </div>                     <div class=\"flex-1\">                         <h4 class=\"font-bold text-sm text-gray-800\">${name}</h4>                         <p class=\"text-xs text-gray-500 truncate\">Klik untuk chat</p>                     </div>                 `;                 list.appendChild(div);             }         }          function renderMessages(roomId) {             const container = document.getElementById('messages-container');             container.innerHTML = \"\";             const messages = globalData.chats[roomId] || [];              if(messages.length === 0) {                 container.innerHTML = '<div class=\"text-center text-gray-300 text-sm mt-5\">Belum ada pesan. Say Hi! üëã</div>';                 return;             }              let lastSender = \"\";             messages.forEach(msg => {                 const isMe = msg.sender === currentUser;                 const div = document.createElement('div');                 div.className = `flex flex-col ${isMe ? 'items-end' : 'items-start'} animate-fade-in`;                  if (msg.sender !== lastSender && !isMe) {                     div.innerHTML += `<span class=\"text-[10px] text-gray-500 ml-2 font-bold\">${msg.sender}</span>`;                 }                  div.innerHTML += `                     <div class=\"px-4 py-2 mt-1 max-w-[80%] rounded-2xl text-sm ${isMe ? 'bg-blue-600 text-white rounded-tr-sm' : 'bg-white border text-gray-800 rounded-tl-sm shadow-sm'}\">                         ${msg.text}                         <div class=\"text-[9px] opacity-70 text-right mt-1\">${new Date(msg.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>                     </div>                 `;                 container.appendChild(div);                 lastSender = msg.sender;             });             container.scrollTop = container.scrollHeight;         }          // --- SENDING ---         async function sendMessage() {             const input = document.getElementById('msg-input');             const text = input.value.trim();             if (!text || !currentRoomId) return;              input.value = \"\";             const btn = document.getElementById('send-btn');             btn.disabled = true;              try {                 // Refresh data terbaru dulu sebelum push (PENTING untuk menghindari conflict)                 await fetchData();                   const newMsg = {                     sender: currentUser,                     text: text,                     timestamp: new Date().toISOString()                 };                  // Pastikan room ada                 if (!globalData.chats[currentRoomId]) globalData.chats[currentRoomId] = [];                                  // Push dan Limit history 50 pesan per room                 globalData.chats[currentRoomId].push(newMsg);                 if(globalData.chats[currentRoomId].length > 50) globalData.chats[currentRoomId].shift();                  await saveData(`Msg in ${currentRoomId}`);                 renderMessages(currentRoomId);              } catch (e) {                 alert(\"Gagal kirim: \" + e.message);             } finally {                 btn.disabled = false;                 document.getElementById('msg-input').focus();             }         }                  // Enter to send         document.getElementById('msg-input').addEventListener('keypress', (e) => {             if(e.key === 'Enter') sendMessage();         });      </script> </body> </html>","timestamp":"2026-01-16T03:08:11.799Z"}],"agus_gus":[{"sender":"gus","text":"halo","timestamp":"2026-01-16T03:02:40.335Z"},{"sender":"agus","text":"halo","timestamp":"2026-01-16T03:02:51.246Z"},{"sender":"agus","text":"ee","timestamp":"2026-01-16T03:03:13.925Z"},{"sender":"gus","text":"üñï","timestamp":"2026-01-16T03:03:34.200Z"},{"sender":"agus","text":"wcp","timestamp":"2026-01-16T03:03:55.643Z"},{"sender":"agus","text":"WCl","timestamp":"2026-01-16T03:04:05.887Z"},{"sender":"agus","text":"WC","timestamp":"2026-01-16T03:04:13.660Z"},{"sender":"agus","text":"babwcee","timestamp":"2026-01-16T03:04:43.978Z"},{"sender":"agus","text":"er","timestamp":"2026-01-16T03:05:03.762Z"},{"sender":"agus","text":"eebabuauwe","timestamp":"2026-01-16T03:05:46.294Z"},{"sender":"agus","text":"q itu itu baca-baca apa","timestamp":"2026-01-16T03:06:30.236Z"},{"sender":"agus","text":"ee","timestamp":"2026-01-16T03:06:45.070Z"},{"sender":"gus","text":"ap","timestamp":"2026-01-16T03:06:47.517Z"},{"sender":"gus","text":"<!DOCTYPE html> <html lang=\"id\"> <head>     <meta charset=\"UTF-8\">     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">     <title>GitHub Messenger</title>     <script src=\"https://cdn.tailwindcss.com\"></script>     <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\">     <style>         /* Custom Scrollbar */         ::-webkit-scrollbar { width: 5px; }         ::-webkit-scrollbar-track { background: transparent; }         ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }         .active-chat { background-color: #eff6ff; border-right: 4px solid #2563eb; }     </style> </head> <body class=\"bg-slate-100 h-screen overflow-hidden font-sans\">      <div id=\"login-screen\" class=\"fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4\">         <div class=\"bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center\">             <div class=\"w-16 h-16 bg-blue-600 rounded-full mx-auto flex items-center justify-center text-white text-2xl mb-4\">                 <i class=\"fas fa-user-astronaut\"></i>             </div>             <h2 class=\"text-2xl font-bold text-gray-800 mb-2\">Login Messenger</h2>             <p class=\"text-gray-500 text-sm mb-6\">Pastikan konfigurasi GitHub sudah benar di kodingan.</p>                          <input type=\"text\" id=\"username-input\" placeholder=\"Buat Username Unik...\" class=\"w-full p-3 bg-gray-100 rounded-xl mb-4 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none\">             <button onclick=\"loginUser()\" id=\"login-btn\" class=\"w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 transition\">                 Masuk / Daftar             </button>         </div>     </div>      <div id=\"app-screen\" class=\"hidden flex h-full max-w-7xl mx-auto shadow-2xl bg-white\">                  <div class=\"w-full md:w-1/3 border-r flex flex-col bg-white\">             <div class=\"p-4 bg-slate-50 border-b flex justify-between items-center\">                 <div class=\"flex items-center gap-2\">                     <div class=\"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold\" id=\"my-avatar\">A</div>                     <span class=\"font-bold text-gray-700 truncate\" id=\"display-name\">User</span>                 </div>                 <button onclick=\"location.reload()\" class=\"text-gray-400 hover:text-red-500\"><i class=\"fas fa-sign-out-alt\"></i></button>             </div>              <div class=\"p-3 border-b space-y-2\">                 <button onclick=\"showAddFriendModal()\" class=\"w-full py-2 px-3 bg-blue-50 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-100 text-left\">                     <i class=\"fas fa-user-plus mr-2\"></i> Chat Teman Baru                 </button>                 <button onclick=\"createNewGroup()\" class=\"w-full py-2 px-3 bg-green-50 text-green-600 rounded-lg text-sm font-semibold hover:bg-green-100 text-left\">                     <i class=\"fas fa-users mr-2\"></i> Buat Grup Baru                 </button>             </div>              <div id=\"chat-list\" class=\"flex-1 overflow-y-auto\">                 </div>         </div>          <div class=\"hidden md:flex flex-1 flex-col bg-slate-50 relative w-full\" id=\"chat-area\">                          <div class=\"p-4 bg-white border-b flex justify-between items-center shadow-sm\">                 <div class=\"flex items-center gap-3\">                     <button class=\"md:hidden text-gray-500\" onclick=\"backToMenu()\"><i class=\"fas fa-arrow-left\"></i></button>                     <div>                         <h3 class=\"font-bold text-gray-800\" id=\"current-room-name\">Pilih Chat</h3>                         <p class=\"text-xs text-green-500\" id=\"status-indicator\">Ready</p>                     </div>                 </div>                 <button onclick=\"refreshData()\" class=\"text-gray-400 hover:text-blue-500\"><i class=\"fas fa-sync-alt\"></i></button>             </div>              <div id=\"messages-container\" class=\"flex-1 p-4 overflow-y-auto space-y-4\">                 <div class=\"text-center text-gray-400 mt-10\">Pilih teman atau grup di samping untuk mulai chat.</div>             </div>              <div class=\"p-3 bg-white border-t\">                 <div class=\"flex gap-2 bg-gray-100 p-1 rounded-full border focus-within:ring-2 focus-within:ring-blue-500 focus-within:bg-white\">                     <input type=\"text\" id=\"msg-input\" placeholder=\"Tulis pesan...\" class=\"flex-1 bg-transparent px-4 py-2 outline-none\" disabled>                     <button onclick=\"sendMessage()\" id=\"send-btn\" class=\"w-10 h-10 bg-blue-600 text-white rounded-full hover:bg-blue-700 flex items-center justify-center transition disabled:opacity-50\" disabled>                         <i class=\"fas fa-paper-plane\"></i>                     </button>                 </div>             </div>         </div>     </div>      <script>         // ==========================================         // ‚ö†Ô∏è KONFIGURASI WAJIB DIISI ‚ö†Ô∏è         // ==========================================         const GH_CONFIG = {             owner: \"USERNAME_GITHUB\",               repo: \"NAMA_REPO\",                      path: \"data.json\",                      token: \"TOKEN_GITHUB\"               };         // ==========================================          let currentUser = \"\";         let currentRoomId = \"\";          let globalData = { users: [], chats: { \"global\": [] } };         let lastSha = \"\";         let poller = null;          // --- LOGIN SYSTEM ---         async function loginUser() {             const input = document.getElementById('username-input');             const username = input.value.trim().replace(/[^a-zA-Z0-9]/g, ''); // Hanya huruf angka              if (!username) { alert(\"Username tidak boleh kosong/simbol aneh!\"); return; }             if (GH_CONFIG.owner === \"USERNAME_GITHUB\") { alert(\"EDIT DULU KONFIGURASINYA DI KODINGAN!\"); return; }              const btn = document.getElementById('login-btn');             btn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Loading...';             btn.disabled = true;              try {                 // 1. Ambil data database                 await fetchData(true);                  // 2. Cek apakah user baru                 if (!globalData.users.includes(username)) {                     // Register user baru                     globalData.users.push(username);                     await saveData(`Register user ${username}`);                 }                  // 3. Masuk App                 currentUser = username;                 document.getElementById('my-avatar').innerText = currentUser.charAt(0).toUpperCase();                 document.getElementById('display-name').innerText = currentUser;                  document.getElementById('login-screen').classList.add('hidden');                 document.getElementById('app-screen').classList.remove('hidden');                 document.getElementById('app-screen').classList.add('flex');                  renderChatList();                 poller = setInterval(fetchData, 3500); // Auto refresh tiap 3.5 detik              } catch (e) {                 alert(\"Gagal Login: \" + e.message);                 btn.disabled = false;                 btn.innerText = \"Masuk / Daftar\";             }         }          // --- CORE DATA FUNCTIONS ---         async function fetchData(isFirstLoad = false) {             const indicator = document.getElementById('status-indicator');             if(!isFirstLoad) indicator.innerText = \"Syncing...\";              try {                 const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}?t=${Date.now()}`;                 const res = await fetch(url, {                     headers: { 'Authorization': `token ${GH_CONFIG.token}` },                     cache: \"no-store\"                 });                  if (res.status === 404) throw new Error(\"File data.json tidak ditemukan! Buat dulu di GitHub dengan isi {}\");                 if (!res.ok) throw new Error(\"Koneksi bermasalah\");                  const data = await res.json();                                  if (data.sha === lastSha) {                     indicator.innerText = \"Online\";                     return; // Tidak ada perubahan                 }                  lastSha = data.sha;                 const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));                                  // Normalisasi struktur data jika masih kosong/format lama                 if (Array.isArray(content)) {                     globalData = { users: [], chats: { \"global\": content } }; // Migrasi dari versi lama                 } else {                     globalData = content;                     if (!globalData.users) globalData.users = [];                     if (!globalData.chats) globalData.chats = {};                 }                  indicator.innerText = \"Online\";                                  // Re-render UI                 renderChatList();                 if (currentRoomId) renderMessages(currentRoomId);              } catch (e) {                 console.error(e);                 indicator.innerText = \"Error!\";             }         }          async function saveData(commitMessage) {             const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}`;             const contentEncoded = btoa(unescape(encodeURIComponent(JSON.stringify(globalData))));              const res = await fetch(url, {                 method: 'PUT',                 headers: {                     'Authorization': `token ${GH_CONFIG.token}`,                     'Content-Type': 'application/json'                 },                 body: JSON.stringify({                     message: commitMessage,                     content: contentEncoded,                     sha: lastSha                 })             });              if (!res.ok) throw new Error(\"Gagal menyimpan data (Conflict). Coba lagi.\");             const data = await res.json();             lastSha = data.content.sha; // Update SHA baru         }          // --- LOGIC ROOM & CHAT ---         function getRoomId(userA, userB) {             // Urutkan nama abjad supaya ID nya konsisten siapa pun yang buka             return [userA, userB].sort().join('_');         }          function showAddFriendModal() {             const targetUser = prompt(\"Masukkan Username teman yang ingin di-chat:\");             if (!targetUser) return;             if (targetUser === currentUser) return alert(\"Gak bisa chat diri sendiri.\");                          // Cek apakah user terdaftar di database             if (!globalData.users.includes(targetUser)) {                 alert(\"User tersebut belum terdaftar (belum pernah login).\");                 return;             }              const roomId = getRoomId(currentUser, targetUser);             openChat(roomId, targetUser);         }          function createNewGroup() {             const groupName = prompt(\"Masukkan Nama Grup:\");             if (!groupName) return;             const roomId = \"GROUP_\" + groupName.replace(/\\s+/g, '_');                          if (!globalData.chats[roomId]) {                 globalData.chats[roomId] = []; // Init grup kosong                 saveData(`Create group ${groupName}`); // Simpan biar muncul di orang lain             }             openChat(roomId, groupName);         }          function openChat(roomId, displayTitle) {             currentRoomId = roomId;                          // UI Update             document.getElementById('current-room-name').innerText = displayTitle;             document.getElementById('msg-input').disabled = false;             document.getElementById('send-btn').disabled = false;             document.getElementById('chat-area').classList.remove('hidden');             document.getElementById('chat-area').classList.add('flex');                          // Mobile view toggle             if(window.innerWidth < 768) {                 document.querySelector('.w-full.md\\\\:w-1\\\\/3').classList.add('hidden');             }              // Pastikan array chat ada             if (!globalData.chats[roomId]) {                 globalData.chats[roomId] = [];             }              renderMessages(roomId);             renderChatList(); // Untuk highlight active chat         }          function backToMenu() {             document.getElementById('chat-area').classList.add('hidden');             document.querySelector('.w-full.md\\\\:w-1\\\\/3').classList.remove('hidden');             currentRoomId = \"\";         }          // --- RENDERING UI ---         function renderChatList() {             const list = document.getElementById('chat-list');             list.innerHTML = \"\";              // 1. Global Chat (Selalu ada)             renderValidChatItem(\"global\", \"Global Chat\", \"fas fa-globe\");              // 2. Loop semua key di chats untuk mencari chat yang relevan dengan user ini             Object.keys(globalData.chats).forEach(roomId => {                 if (roomId === \"global\") return;                  // Logika Group                 if (roomId.startsWith(\"GROUP_\")) {                     const groupName = roomId.replace(\"GROUP_\", \"\").replace(/_/g, \" \");                     renderValidChatItem(roomId, groupName, \"fas fa-users\");                 }                 // Logika Private Chat (Cek apakah nama kita ada di ID room)                 else if (roomId.includes(currentUser)) {                     // Extract nama lawan bicara                     const parts = roomId.split('_');                     const friendName = parts[0] === currentUser ? parts[1] : parts[0];                     renderValidChatItem(roomId, friendName, \"fas fa-user\");                 }             });              function renderValidChatItem(id, name, icon) {                 const div = document.createElement('div');                 const isActive = id === currentRoomId;                 div.className = `p-3 flex items-center gap-3 cursor-pointer hover:bg-gray-100 transition ${isActive ? 'active-chat' : ''}`;                 div.onclick = () => openChat(id, name);                                  div.innerHTML = `                     <div class=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600\">                         <i class=\"${icon}\"></i>                     </div>                     <div class=\"flex-1\">                         <h4 class=\"font-bold text-sm text-gray-800\">${name}</h4>                         <p class=\"text-xs text-gray-500 truncate\">Klik untuk chat</p>                     </div>                 `;                 list.appendChild(div);             }         }          function renderMessages(roomId) {             const container = document.getElementById('messages-container');             container.innerHTML = \"\";             const messages = globalData.chats[roomId] || [];              if(messages.length === 0) {                 container.innerHTML = '<div class=\"text-center text-gray-300 text-sm mt-5\">Belum ada pesan. Say Hi! üëã</div>';                 return;             }              let lastSender = \"\";             messages.forEach(msg => {                 const isMe = msg.sender === currentUser;                 const div = document.createElement('div');                 div.className = `flex flex-col ${isMe ? 'items-end' : 'items-start'} animate-fade-in`;                  if (msg.sender !== lastSender && !isMe) {                     div.innerHTML += `<span class=\"text-[10px] text-gray-500 ml-2 font-bold\">${msg.sender}</span>`;                 }                  div.innerHTML += `                     <div class=\"px-4 py-2 mt-1 max-w-[80%] rounded-2xl text-sm ${isMe ? 'bg-blue-600 text-white rounded-tr-sm' : 'bg-white border text-gray-800 rounded-tl-sm shadow-sm'}\">                         ${msg.text}                         <div class=\"text-[9px] opacity-70 text-right mt-1\">${new Date(msg.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>                     </div>                 `;                 container.appendChild(div);                 lastSender = msg.sender;             });             container.scrollTop = container.scrollHeight;         }          // --- SENDING ---         async function sendMessage() {             const input = document.getElementById('msg-input');             const text = input.value.trim();             if (!text || !currentRoomId) return;              input.value = \"\";             const btn = document.getElementById('send-btn');             btn.disabled = true;              try {                 // Refresh data terbaru dulu sebelum push (PENTING untuk menghindari conflict)                 await fetchData();                   const newMsg = {                     sender: currentUser,                     text: text,                     timestamp: new Date().toISOString()                 };                  // Pastikan room ada                 if (!globalData.chats[currentRoomId]) globalData.chats[currentRoomId] = [];                                  // Push dan Limit history 50 pesan per room                 globalData.chats[currentRoomId].push(newMsg);                 if(globalData.chats[currentRoomId].length > 50) globalData.chats[currentRoomId].shift();                  await saveData(`Msg in ${currentRoomId}`);                 renderMessages(currentRoomId);              } catch (e) {                 alert(\"Gagal kirim: \" + e.message);             } finally {                 btn.disabled = false;                 document.getElementById('msg-input').focus();             }         }                  // Enter to send         document.getElementById('msg-input').addEventListener('keypress', (e) => {             if(e.key === 'Enter') sendMessage();         });      </script> </body> </html>","timestamp":"2026-01-16T03:06:59.388Z"},{"sender":"agus","text":"bab","timestamp":"2026-01-16T03:06:59.230Z"}]}}